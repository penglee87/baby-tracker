<view class="tracker-page">
  <view class="header">
    <text class="title">å®å®è®°å½•ï¼ˆ{{todayKey}}ï¼‰</text>
    <text class="subtitle">å½“å‰å®å®ï¼š{{babyId}}</text>
    <text class="stats">{{statsText}}</text>
  </view>

  <!-- Status Card -->
  <view class="status-card-section" wx:if="{{currentStatus && currentStatus.isSleeping}}">
    <view class="status-card {{currentStatus.isLongSleep ? 'status-warning' : 'status-sleep'}}">
      <view class="status-icon">ğŸ˜´</view>
      <view class="status-info">
        <text class="status-title">ç¡è§‰ä¸­</text>
        <text class="status-desc">å¼€å§‹äº {{currentStatus.startTimeStr}}</text>
        <text class="status-duration" wx:if="{{currentStatus.durationStr}}">å·²ç¡çº¦ {{currentStatus.durationStr}}</text>
        <text class="status-tip" wx:if="{{currentStatus.isLongSleep}}">å®å®ç¡å¾—æœ‰ç‚¹ä¹…äº†ï¼Œè¦ä¸è¦ç¡®è®¤ä¸€ä¸‹ï¼Ÿ</text>
      </view>
    </view>
  </view>

  <!-- Timer Section -->
  <!-- 
  <view class="timer-section">
    <block wx:if="{{timerState === 'idle'}}">
      <view class="timer-idle">
        <button class="timer-start-btn" data-type="sleep" bindtap="startTimer">
          <text>ğŸŒ™ è®¡æ—¶ç¡è§‰</text>
        </button>
        <button class="timer-start-btn" data-type="feed" bindtap="startTimer">
          <text>ğŸ¼ è®¡æ—¶äº²å–‚</text>
        </button>
      </view>
    </block>
    <block wx:else>
      <view class="timer-running">
        <view class="timer-info">
          <text class="timer-label">{{timerType === 'sleep' ? 'æ­£åœ¨ç¡è§‰' : 'æ­£åœ¨äº²å–‚'}}</text>
          <text class="timer-value">{{timerValue}}</text>
        </view>
        <view class="timer-controls">
          <button class="timer-ctrl-btn cancel" bindtap="cancelTimer">å–æ¶ˆ</button>
          <button class="timer-ctrl-btn finish" bindtap="endTimer">ç»“æŸ</button>
        </view>
      </view>
    </block>
  </view>
  -->

  <view class="quick-grid">
    <block wx:for="{{quickActions}}" wx:key="type">
      <view class="grid-item">
        <button class="quick-btn {{item.colorClass}}" data-type="{{item.type}}" bindtap="tapQuickAdd">
          <text class="btn-icon">{{item.icon}}</text>
          <text class="btn-label">{{item.label}}</text>
        </button>
        <block wx:if="{{editActionsMode}}">
          <view class="sort-controls">
            <view class="sort-btn" data-index="{{index}}" bindtap="moveActionUp">â¬†ï¸</view>
            <view class="sort-btn" data-index="{{index}}" bindtap="moveActionDown">â¬‡ï¸</view>
            <view class="sort-btn" data-index="{{index}}" bindtap="moveActionTop">ğŸ”</view>
            <view class="sort-btn delete-btn" data-index="{{index}}" bindtap="removeAction">âŒ</view>
          </view>
        </block>
      </view>
    </block>
    
    <!-- Add Action Button -->
    <view class="grid-item">
      <button class="quick-btn add-btn" bindtap="openAddAction">
        <text class="btn-icon">â•</text>
        <text class="btn-label">æ·»åŠ </text>
      </button>
    </view>
  </view>
  
  <view class="section-divider">
    <text class="section-title">å¿«æ·å¤‡æ³¨</text>
    <view class="edit-toggle" bindtap="toggleEditActions">
      <text>{{editActionsMode ? 'å®Œæˆæ’åº' : 'ç®¡ç†è¡Œä¸º'}}</text>
    </view>
  </view>
  <view class="notes-row">
    <block wx:if="{{!hasModalOpen}}">
      <input class="notes-input" placeholder="å¤‡æ³¨ï¼ˆå¯é€‰ï¼‰" bindinput="notesInput" value="{{inputNotes}}" />
    </block>
    <block wx:else>
      <view class="notes-input {{!inputNotes ? 'text-placeholder' : ''}}">
        {{inputNotes || 'å¤‡æ³¨ï¼ˆå¯é€‰ï¼‰'}}
      </view>
    </block>
  </view>
  <view class="list">
    <view class="list-title">æœ€è¿‘è®°å½•</view>
    <block wx:for="{{events}}" wx:key="_id">
      <view class="item" bindtap="openItemActions" data-id="{{item._id}}">
        <text class="time">{{item.timeDisplay}}</text>
        <text class="type">{{item.typeLabel}}</text>
        <block wx:if="{{item.quantity}}">
          <text class="meta">{{item.quantity}} ml</text>
        </block>
        <block wx:if="{{item.durationMinutes}}">
          <text class="meta">{{item.durationMinutes}} åˆ†é’Ÿ</text>
        </block>
        <block wx:if="{{item.notes}}">
          <text class="notes">{{item.notes}}</text>
        </block>
      </view>
    </block>
  </view>

  <view class="overlay" wx:if="{{showQuantityModal}}">
    <view class="modal">
      <text class="modal-title">è¯·è¾“å…¥æ¯«å‡æ•°</text>
      <input type="number" class="modal-input" placeholder="æ•°é‡ï¼ˆmlï¼‰" bindinput="quantityInput" value="{{inputQuantity}}" />
      <picker mode="time" value="{{inputTime}}" bindchange="onTimeChange">
        <view class="modal-input">æ—¶é—´ï¼š{{inputTime}}</view>
      </picker>
      <view class="modal-actions">
        <button class="cancel" bindtap="cancelModal">å–æ¶ˆ</button>
        <button class="confirm" bindtap="commitEvent">ç¡®å®š</button>
      </view>
    </view>
  </view>

  <view class="overlay" wx:if="{{showDurationModal}}">
    <view class="modal">
      <text class="modal-title">è¯·è¾“å…¥ç¡çœ æ—¶é•¿</text>
      <input type="number" class="modal-input" placeholder="æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰" bindinput="durationInput" value="{{inputDuration}}" />
      <picker mode="time" value="{{inputTime}}" bindchange="onTimeChange">
        <view class="modal-input">æ—¶é—´ï¼š{{inputTime}}</view>
      </picker>
      <view class="modal-actions">
        <button class="cancel" bindtap="cancelModal">å–æ¶ˆ</button>
        <button class="confirm" bindtap="commitEvent">ç¡®å®š</button>
      </view>
    </view>
  </view>

  <view class="overlay" wx:if="{{showTimeModal}}">
    <view class="modal">
      <text class="modal-title">è¯·é€‰æ‹©è®°å½•æ—¶é—´</text>
      <picker mode="time" value="{{inputTime}}" bindchange="onTimeChange">
        <view class="modal-input">æ—¶é—´ï¼š{{inputTime}}</view>
      </picker>
      <view class="modal-actions">
        <button class="cancel" bindtap="cancelModal">å–æ¶ˆ</button>
        <button class="confirm" bindtap="commitEvent">ç¡®å®š</button>
      </view>
    </view>
  </view>

  <view class="overlay" wx:if="{{showBabyModal}}">
    <view class="modal">
      <text class="modal-title">è¾“å…¥å…±äº«ç ï¼ˆåŒå®å®å…±ç”¨åŒä¸€ç ï¼‰</text>
      <input class="modal-input" placeholder="å¦‚ï¼šfamily-001" bindinput="babyIdInput" value="{{inputBabyId}}" />
      <view class="modal-actions">
        <button class="cancel" bindtap="cancelModal">å–æ¶ˆ</button>
        <button class="confirm" bindtap="confirmBabyId">ç¡®å®š</button>
      </view>
    </view>
  </view>
  
  <view class="overlay" wx:if="{{showEditModal}}">
    <view class="modal">
      <text class="modal-title">ç¼–è¾‘è®°å½•</text>
      <picker mode="selector" range="{{typeOptions}}" bindchange="onEditTypeChange">
        <view class="modal-input">ç±»å‹ï¼š{{editType}}</view>
      </picker>
      <picker mode="time" value="{{editTime}}" bindchange="onEditTimeChange">
        <view class="modal-input">æ—¶é—´ï¼š{{editTime}}</view>
      </picker>
      <input type="number" class="modal-input" placeholder="æ•°é‡ï¼ˆmlï¼‰" bindinput="onEditQuantityInput" value="{{editQuantity}}" wx:if="{{editType==='feed'||editType==='drink'}}" />
      <input type="number" class="modal-input" placeholder="æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰" bindinput="onEditDurationInput" value="{{editDuration}}" wx:if="{{editType==='sleep'||editType==='feed'}}" />
      <input class="modal-input" placeholder="å¤‡æ³¨ï¼ˆå¯é€‰ï¼‰" bindinput="onEditNotesInput" value="{{editNotes}}" />
      <view class="modal-actions">
        <button class="cancel" bindtap="cancelEdit">å–æ¶ˆ</button>
        <button class="confirm" bindtap="saveEdit">ä¿å­˜</button>
      </view>
    </view>
  </view>
</view>
